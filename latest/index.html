<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.4">
<meta name="author" content="Burt Beckwith">
<meta name="copyright" content="Apache License, Version 2.0">
<title>Spring Security ACL Plugin - Reference Documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Spring Security ACL Plugin - Reference Documentation</h1>
<div class="details">
<span id="author" class="author">Burt Beckwith</span><br>
<span id="revnumber">version 4.0.0.M1</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#introduction">1. Introduction to the Spring Security ACL Plugin</a></li>
<li><a href="#Installing">2. Installing</a>
<ul class="sectlevel2">
<li><a href="#Distribution">2.1. Distribution</a></li>
<li><a href="#Snapshots">2.2. Snapshots</a></li>
</ul>
</li>
<li><a href="#usage">3. Usage</a>
<ul class="sectlevel2">
<li><a href="#serviceMethods">3.1. Securing Service Methods</a></li>
<li><a href="#acls">3.2. Working with ACLs</a></li>
<li><a href="#domainClasses">3.3. Domain Classes</a></li>
<li><a href="#configuration">3.4. Configuration</a></li>
<li><a href="#runAs">3.5. Run-As Authentication Replacement</a></li>
<li><a href="#customPermissions">3.6. Custom Permissions</a></li>
</ul>
</li>
<li><a href="#tutorial">4. Tutorial</a>
<ul class="sectlevel2">
<li><a href="#actionsubmit-issues">4.1. actionSubmit issues</a></li>
<li><a href="#testing">4.2. Testing</a></li>
</ul>
</li>
<li><a href="#sampleApp">5. Sample Application</a></li>
<li><a href="#AclUtilService">6. AclUtilService</a>
<ul class="sectlevel2">
<li><a href="#addPermission">6.1. addPermission</a></li>
<li><a href="#changeOwner">6.2. changeOwner</a></li>
<li><a href="#deleteAcl">6.3. deleteAcl</a></li>
<li><a href="#deletePermission">6.4. deletePermission</a></li>
<li><a href="#hasPermission">6.5. hasPermission</a></li>
<li><a href="#readAcl">6.6. readAcl</a></li>
</ul>
</li>
<li><a href="#Scripts">7. Scripts</a>
<ul class="sectlevel2">
<li><a href="#s2-create-acl-domains">7.1. s2-create-acl-domains</a></li>
</ul>
</li>
<li><a href="#TagLibraries">8. Tag Libraries</a>
<ul class="sectlevel2">
<li><a href="#permitted">8.1. permitted</a></li>
<li><a href="#notPermitted">8.2. notPermitted</a></li>
</ul>
</li>
<li><a href="#History">9. History</a>
<ul class="sectlevel2">
<li><a href="#authors">9.1. Authors</a></li>
<li><a href="#previouswork">9.2. Previous work</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="introduction">1. Introduction to the Spring Security ACL Plugin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The ACL plugin adds Domain Object Security support to a Grails application that uses Spring Security. It depends on the <a href="http://grails.org/plugin/spring-security-core">Spring Security Core plugin</a>.</p>
</div>
<div class="paragraph">
<p>The core plugin and other extension plugins support restricting access to URLs via rules that include checking a user&#8217;s authentication status, roles, etc. and the ACL plugin extends this by adding support for restricting access to individual domain class instances. The access can be very fine-grained and can define which actions can be taken on an object - these typically include Read, Create, Write, Delete, and Administer but you&#8217;re free to define whatever actions you like.</p>
</div>
<div class="paragraph">
<p>To learn about using ACLs in Grails, you can follow the <a href="#tutorial">Tutorial</a> and in addition you can download and run a complete Grails application that uses the plugin. Installing and running the application are described in <a href="#sampleApp">Sample Application</a>.</p>
</div>
<div class="paragraph">
<p>In addition to this document, you should read the <a href="http://docs.spring.io/spring-security/site/docs/5.0.x/reference/htmlsingle/#domain-acls">Spring Security documentation</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Installing">2. Installing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Add an entry in the dependencies block of your `build.gradle file, changing the version as needed:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">dependencies {
   ...
   compile 'org.grails.plugins:spring-security-acl:4.0.0.M1'
   ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Different Branches are built for different versions of Grails</p>
</div>
<div class="ulist">
<ul>
<li>
<p>master: Grails 4</p>
</li>
<li>
<p>3.3.x: Grails 3.3+</p>
</li>
<li>
<p>grails_32: Grails 3.2</p>
</li>
<li>
<p>2.x: Grails 2</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Current version (master) is for Grails 4 only.
Previous version (3.3.x) is only compatible with Grails 3.3.x or higher.</p>
</div>
<div class="paragraph">
<p>For previous Grails 3 versions ( 3.0.x, 3.1.x and 3.2.x ) use:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">dependencies {
   ...
   compile 'org.grails.plugins:spring-security-acl:3.1.1'
   ...</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="Distribution">2.1. Distribution</h3>
<div class="paragraph">
<p>Grails Spring Security ACL plugin is <a href="https://bintray.com/grails/plugins/spring-security-acl">distributed in bintray</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="Snapshots">2.2. Snapshots</h3>
<div class="paragraph">
<p>Snapshots are published automatically to <a href="https://oss.jfrog.org/">Artifactory OSS</a> on every successful build.
You can use them by defining this Maven repository inside
the <code>repositories</code> block in your <code>build.gradle</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">maven { url "https://oss.jfrog.org/artifactory/oss-snapshot-local" }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="usage">3. Usage</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="serviceMethods">3.1. Securing Service Methods</h3>
<div class="paragraph">
<p>There are two primary use cases for ACL security: determining whether a user is allowed to perform an action on an instance before the action is invoked, and restricting access to single or multiple instances after methods are invoked (this is typically implemented by collection filtering). You can call <code>aclUtilService.hasPermission()</code> explicitly, but this tends to clutter your code with security logic that often has little to do with business logic. Instead, Spring Security provides some convenient annotations that are used to wrap your method calls in access checks.</p>
</div>
<div class="paragraph">
<p>There are four annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://docs.spring.io/spring-security/site/docs/5.0.x/apidocs/org/springframework/security/access/prepost/PreAuthorize.html">@PreAuthorize</a></p>
</li>
<li>
<p><a href="http://docs.spring.io/spring-security/site/docs/5.0.x/apidocs/org/springframework/security/access/prepost/PreFilter.html">@PreFilter</a></p>
</li>
<li>
<p><a href="http://docs.spring.io/spring-security/site/docs/5.0.x/apidocs/org/springframework/security/access/prepost/PostAuthorize.html">@PostAuthorize</a></p>
</li>
<li>
<p><a href="http://docs.spring.io/spring-security/site/docs/5.0.x/apidocs/org/springframework/security/access/prepost/PostFilter.html">@PostFilter</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The annotations use security-specific Spring expression language (SpEL) expressions - see <a href="http://docs.spring.io/spring-security/site/docs/5.0.x/reference/htmlsingle/#el-access">the documentation</a> for the available standard and method expressions.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example service that manages a <code>Report</code> domain class and uses these annotations and expressions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">import org.springframework.security.access.prepost.PostFilter
import org.springframework.security.access.prepost.PreAuthorize
import grails.gorm.transactions.Transactional

import com.yourapp.Report

class ReportService {

   @PreAuthorize("hasPermission(#id, 'com.yourapp.Report', read) or " +
                 "hasPermission(#id, 'com.yourapp.Report', admin)")
   Report getReport(long id) {
      Report.get(id)
   }

   @Transactional
   @PreAuthorize("hasRole('ROLE_USER')")
   Report createReport(params) {
      Report report = new Report(params)
      report.save()
      report
   }

   @PreAuthorize("hasRole('ROLE_USER')")
   @PostFilter("hasPermission(filterObject, read) or " +
               "hasPermission(filterObject, admin)")
   List getAllReports(params = [:]) {
      Report.list(params)
   }

   @Secured(['ROLE_USER', 'ROLE_ADMIN'])
   String getReportName(long id) {
      Report.get(id).name
   }

   @Transactional
   @PreAuthorize("hasPermission(#report, write) or " +
                 "hasPermission(#report, admin)")
   Report updateReport(Report report, params) {
      report.properties = params
      report.save()
      report
   }

   @Transactional
   @PreAuthorize("hasPermission(#report, delete) or " +
                 "hasPermission(#report, admin)")
   void deleteReport(Report report) {
      report.delete()
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration specifies these rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getReport</code> requires that the authenticated user have <code>BasePermission.READ</code> or <code>BasePermission.ADMIN</code> for the instance</p>
</li>
<li>
<p><code>createReport</code> requires <code>ROLE_USER</code></p>
</li>
<li>
<p><code>getAllReports</code> requires <code>ROLE_USER</code> and will have elements removed from the returned <code>List</code> that the user doesn&#8217;t have an ACL grant for; the user must have <code>BasePermission.READ</code> or <code>BasePermission.ADMIN</code> for each element in the list; elements that don&#8217;t have access granted will be removed</p>
</li>
<li>
<p><code>getReportName</code> requires that the authenticated user have either <code>ROLE_USER</code> or <code>ROLE_ADMIN</code> (but no ACL rules)</p>
</li>
<li>
<p><code>updateReport</code> has no role restrictions but must satisfy the requirements of the <code>aclReportWriteVoter</code> voter (which has the <code>ACL_REPORT_WRITE</code> config attribute), i.e. <code>BasePermission.ADMINISTRATION</code> or <code>BasePermission.WRITE</code></p>
</li>
<li>
<p><code>deleteReport</code> has no role restrictions but must satisfy the requirements of the <code>aclReportDeleteVoter</code> voter (which has the <code>ACL_REPORT_DELETE</code> config attribute), i.e. <code>BasePermission.ADMINISTRATION</code> or <code>BasePermission.DELETE</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="acls">3.2. Working with ACLs</h3>
<div class="sect3">
<h4 id="suggested-application-changes">3.2.1. Suggested application changes</h4>
<div class="paragraph">
<p>To properly display access denied exceptions (e.g. when a user tries to perform an action but doesn&#8217;t have a grant authorizing it), you should create a mapping in <code>grails-app/controllers/UrlMappings.groovy</code> for error code 403. In addition, it&#8217;s possible to trigger a <a href="http://docs.spring.io/spring-security/site/docs/5.0.x/apidocs/org/springframework/security/acls/model/NotFoundException.html">NotFoundException</a> which will create an error 500, but should be treated like a 403 error, so you should add mappings for these conditions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">import org.springframework.security.access.AccessDeniedException
import org.springframework.security.acls.model.NotFoundException

class UrlMappings {

   static mappings = {

      ...

      "403"(controller: "errors", action: "error403")
      "500"(controller: "errors", action: "error500")
      "500"(controller: "errors", action: "error403",
            exception: AccessDeniedException)
      "500"(controller: "errors", action: "error403",
            exception: NotFoundException)
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>These depend on an <code>ErrorsController</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.yourcompany.yourapp

import grails.plugin.springsecurity.annotation.Secured

@Secured('permitAll')
class ErrorsController {

   def error403() {}

   def error500() {
      render view: '/error'
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and a <code>grails-app/views/errors/error403.gsp</code> similar to this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-html" data-lang="html">&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Access denied!&lt;/title&gt;
&lt;meta name='layout' content='main' /&gt;
&lt;/head&gt;

&lt;body&gt;
&lt;h1&gt;Access Denied&lt;/h1&gt;
&lt;p&gt;We're sorry, but you are not authorized to
   perform the requested operation.&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="actionsubmit">3.2.2. actionSubmit</h4>
<div class="paragraph">
<p>Grails has a convenient feature where it supports multiple submit actions per form via the <code>&lt;g:actionSubmit&gt;</code> tag. This is done by posting to the <code>index</code> action but with a special parameter that indicates which action to invoke. This is a problem in general for security since any URL rules for edit, delete, save, etc. will be bypassed. It&#8217;s an even more significant issue with ACLs because of the way that the access denied exception interacts with the <code>actionSubmit</code> processing. If you don&#8217;t make any adjustments for this, your users will see a blank page when they attempt to submit a form and the action is disallowed. The solution is to remove <code>actionSubmit</code> buttons and replace them with regular submit buttons. This requires one form per button, and without adjusting the CSS the buttons will look differently than if they were in-line <code>actionSubmit</code> buttons, but that is fixable with the appropriate CSS changes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that this is not an issue when using the generated GSPs in Grails 3 because they&#8217;ve been reworked to use the fields plugin, but if you have an older application that you&#8217;ve upgraded or if you have GSPs that don&#8217;t use the newer approach, you will need to avoid using <code>actionSubmit</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It&#8217;s simple to adjust the <code>actionSubmit</code> buttons and you&#8217;ll need to change them in <code>show.gsp</code> and <code>edit.gsp</code>; <code>list.gsp</code> (or <code>index.gsp</code>) and <code>show.gsp</code> don&#8217;t need any changes. In <code>show.gsp</code>, replace the two actionSubmit buttons with these two forms (maintain the g:message tags; the strings are hard-coded here to reduce clutter):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-html" data-lang="html">&lt;div class="buttons"&gt;
   &lt;g:form action='edit'&gt;
      &lt;g:hiddenField name="id" value="${reportInstance?.id}" /&gt;
      &lt;span class="button"&gt;
         &lt;g:submitButton class="edit" name="Edit" /&gt;
      &lt;/span&gt;
   &lt;/g:form&gt;
   &lt;g:form action='delete'&gt;
      &lt;g:hiddenField name="id" value="${reportInstance?.id}" /&gt;
      &lt;span class="button"&gt;
         &lt;g:submitButton class="delete" name="Delete"
                         onclick="return confirm('Are you sure?');" /&gt;
      &lt;/span&gt;
   &lt;/g:form&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In <code>edit.gsp</code>, change the <code>&lt;form&gt;</code> tag to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-html" data-lang="html">&lt;g:form action='update'&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>and convert the update button to a regular submit button:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-html" data-lang="html">&lt;div class="buttons"&gt;
   &lt;span class="button"&gt;
      &lt;g:submitButton class="save" name="Update" /&gt;
   &lt;/span&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>and move the delete button out of the form into its own form just below the main form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-html" data-lang="html">&lt;g:form action='delete'&gt;
   &lt;g:hiddenField name="id" value="${reportInstance?.id}" /&gt;
   &lt;div class="buttons"&gt;
      &lt;span class="button"&gt;
         &lt;g:submitButton class="delete" name="Delete"
                         onclick="return confirm('Are you sure?');" /&gt;
      &lt;/span&gt;
   &lt;/div&gt;
&lt;/g:form&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="domainClasses">3.3. Domain Classes</h3>
<div class="paragraph">
<p>The plugin uses domain classes to manage database state. Ordinarily the database structure isn&#8217;t all that important, but to be compatible with the traditional JDBC-based Spring Security code, the domain classes are configured to generate the table and column names that are used there.</p>
</div>
<div class="paragraph">
<p>The plugin classes related to persistence use these classes, so they&#8217;re included in the plugin but can be overridden by running the <a href="#s2-create-acl-domains">s2-create-acl-domains</a> script.</p>
</div>
<div class="paragraph">
<p>As you can see, the database structure is highly normalized.</p>
</div>
<div class="sect3">
<h4 id="aclclass">3.3.1. AclClass</h4>
<div class="paragraph">
<p>The <code>AclClass</code> domain class contains entries for the names of each application domain class that has associated permissions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">package grails.plugin.springsecurity.acl

class AclClass {

	String className

	@Override
	String toString() {
		"AclClass id $id, className $className"
	}

	static mapping = {
		className column: 'class'
		version false
	}

	static constraints = {
		className unique: true, blank: false
	}
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="aclsid">3.3.2. AclSid</h4>
<div class="paragraph">
<p>The <code>AclSid</code> domain class contains entries for the names of grant recipients (a principal or authority - SID is an acronym for &#8220;security identity&#8221;). These are typically usernames (where <code>principal</code> is <code>true</code>) but can also be a <code>GrantedAuthority</code> (role name, where <code>principal</code> is <code>false</code>). When granting permissions to a role, any user with that role receives that permission:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">package grails.plugin.springsecurity.acl

class AclSid {

	String sid
	boolean principal

	@Override
	String toString() {
		"AclSid id $id, sid $sid, principal $principal"
	}

	static mapping = {
		version false
	}

	static constraints = {
		principal unique: 'sid'
		sid blank: false, size: 1..255
	}
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="aclobjectidentity">3.3.3. AclObjectIdentity</h4>
<div class="paragraph">
<p>The <code>AclObjectIdentity</code> domain class contains entries representing individual domain class instances (OIDs). It has a field for the instance id (<code>objectId</code>) and domain class (<code>aclClass</code>) that uniquely identify the instance. In addition there are optional nullable fields for the parent OID (<code>parent</code>) and owner (<code>owner</code>). There&#8217;s also a flag (<code>entriesInheriting</code>) to indicate whether ACL entries can inherit from a parent ACL.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">package grails.plugin.springsecurity.acl

class AclObjectIdentity extends AbstractAclObjectIdentity {

	Long objectId

	@Override
	String toString() {
		"AclObjectIdentity id $id, aclClass $aclClass.className, " +
		"objectId $objectId, entriesInheriting $entriesInheriting"
	}

	static mapping = {
		version false
		aclClass column: 'object_id_class'
		owner column: 'owner_sid'
		parent column: 'parent_object'
		objectId column: 'object_id_identity'
	}

	static constraints = {
		objectId unique: 'aclClass'
	}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>AclObjectIdentity</code> actually extends a base class, <code>AbstractAclObjectIdentity</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">abstract class AbstractAclObjectIdentity {

   AclClass aclClass
   AclObjectIdentity parent
   AclSid owner
   boolean entriesInheriting

   static constraints = {
      parent nullable: true
      owner nullable: true
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default it&#8217;s assumed that domain classes have a numeric primary key, but that&#8217;s not required. So the default implementation has a <code>Long</code> <code>objectId</code> field, but if you want to support other types of ids you can change that field and retain the other standard functionality from the base class.</p>
</div>
</div>
<div class="sect3">
<h4 id="aclentry">3.3.4. AclEntry</h4>
<div class="paragraph">
<p>Finally, the <code>AclEntry</code> domain class contains entries representing grants (or denials) of a permission on an object instance to a recipient. The <code>aclObjectIdentity</code> field references the domain class instance (since an instance can have many granted permissions). The <code>sid</code> field references the recipient. The <code>granting</code> field determines whether the entry grants the permission (<code>true</code>) or denies it (<code>false</code>). The <code>aceOrder</code> field specifies the position of the entry, which is important because the entries are evaluated in order and the first matching entry determines whether access is allowed. <code>auditSuccess</code> and <code>auditFailure</code> determine whether to log success and/or failure events (these both default to <code>false</code>).</p>
</div>
<div class="paragraph">
<p>The <code>mask</code> field holds the permission. This can be a source of confusion because the name (and the Spring Security documentation) indicates that it&#8217;s a bit mask. A value of 1 indicates permission A, a value of 2 indicates permission B, a value of 4 indicates permission C, a value of 8 indicates permission D, etc. So you would think that a value of 5 would indicate a grant of both permission A and C. Unfortunately this is not the case. There is a <a href="http://docs.spring.io/spring-security/site/docs/5.0.x/apidocs/org/springframework/security/acls/domain/CumulativePermission.html">CumulativePermission</a> class that supports this, but the standard classes don&#8217;t support it (<code>AclImpl.isGranted()</code> checks for == rather than using | (bitwise or) so a combined entry would never match). So rather than grouping all permissions for one recipient on one instances into a bit mask, you must create individual records for each.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-groovy" data-lang="groovy">package grails.plugin.springsecurity.acl

class AclEntry {

	AclObjectIdentity aclObjectIdentity
	int aceOrder
	AclSid sid
	int mask
	boolean granting
	boolean auditSuccess
	boolean auditFailure

	@Override
	String toString() {
		"AclEntry id $id, aceOrder $aceOrder, mask $mask, granting $granting, " +
		"aclObjectIdentity $aclObjectIdentity"
	}

	static mapping = {
		version false
		sid column: 'sid'
		aclObjectIdentity column: 'acl_object_identity'
	}

	static constraints = {
		aceOrder unique: 'aclObjectIdentity'
	}
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration">3.4. Configuration</h3>
<div class="paragraph">
<p>Creating, editing, or deleting permissions requires an authenticated user. In most cases  if the authenticated user is the owner of the ACL then access is allowed, but granted roles also affect whether access is allowed. The default required role is <code>ROLE_ADMIN</code> for all actions, but this can be configured in <code>grails-app/conf/application.groovy</code>. This table summarizes the attribute names and the corresponding actions that are allowed for it:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Attribute</strong></th>
<th class="tableblock halign-left valign-top"><strong>Affected methods</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity. acl.authority. modifyAuditingDetails</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuditableAcl.updateAuditing()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity. acl.authority. changeOwnership</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OwnershipAcl.setOwner()</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity. acl.authority. changeAclDetails</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MutableAcl.deleteAce()</code>, <code>MutableAcl.insertAce()</code>, <code>MutableAcl.setEntriesInheriting()</code>, <code>MutableAcl.setParent()</code>, <code>MutableAcl.updateAce()</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can leave the attributes set to <code>ROLE_ADMIN</code> or change them to have separate values, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">grails.plugin.springsecurity.acl.authority.
        modifyAuditingDetails = 'ROLE_ACL_MODIFY_AUDITING'

grails.plugin.springsecurity.acl.authority.
        changeOwnership = 'ROLE_ACL_CHANGE_OWNERSHIP'

grails.plugin.springsecurity.acl.authority.
        changeAclDetails = 'ROLE_ACL_CHANGE_DETAILS'</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="run-as-authentication-replacement">3.4.1. Run-As Authentication Replacement</h4>
<div class="paragraph">
<p>There are also two options to configure <a href="http://docs.spring.io/spring-security/site/docs/5.0.x/reference/htmlsingle/#runas">Run-As Authentication Replacement</a>:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Attribute</strong></th>
<th class="tableblock halign-left valign-top"><strong>Meaning</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity. useRunAs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">change to <code>true</code> to enable; defaults to <code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.plugin.springsecurity. runAs.key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a shared key between the two standard implementation classes, used to verify that a third party hasn&#8217;t created a token for the user; should be changed from its default value</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">grails.plugin.springsecurity.useRunAs = true
grails.plugin.springsecurity.runAs.key = 'your run-as key'</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="runAs">3.5. Run-As Authentication Replacement</h3>
<div class="paragraph">
<p>Although not strictly related to ACLs, the plugin implements <a href="http://docs.spring.io/spring-security/site/docs/5.0.x/reference/htmlsingle/#runas">Run-As Authentication Replacement</a> since it&#8217;s related to method security in general. This feature is similar to the Switch User feature of the Spring Security Core plugin, but instead of running as another user until you choose to revert to your original <code>Authentication</code>, the temporary authentication switch only lasts for one method invocation.</p>
</div>
<div class="paragraph">
<p>For example, in this service <code>someMethod()</code> requires that the authenticated user have <code>ROLE_ADMIN</code> and will also be granted <code>ROLE_RUN_AS_SUPERUSER</code> for the duration of the method only:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">class SecureService {

   @Secured(['ROLE_ADMIN', 'RUN_AS_SUPERUSER'])
   def someMethod() {
      ...
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="customPermissions">3.6. Custom Permissions</h3>
<div class="paragraph">
<p>By default there are 5 permissions available from the <code>org.springframework.security.acls.domain. BasePermission</code> class: <code>READ</code>, <code>WRITE</code>, <code>CREATE</code>, <code>DELETE</code>, and <code>ADMINISTRATION</code>. You can also add your own permissions if these aren&#8217;t sufficient.</p>
</div>
<div class="paragraph">
<p>The easiest approach is to create a subclass of <code>BasePermission</code> and add your new permissions there. This way you retain the default permissions and can use them if you need. For example, here&#8217;s a subclass that adds a new <code>APPROVE</code> permission:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.mycompany.myapp;

import org.springframework.security.acls.domain.BasePermission;
import org.springframework.security.acls.model.Permission;

public class MyPermission extends BasePermission {

   public static final Permission APPROVE = new MyPermission(1 &lt;&lt; 5, 'V');

   protected MyPermission(int mask) {
      super(mask);
   }

   protected MyPermission(int mask, char code) {
      super(mask, code);
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It sets the mask value to 32 (1 &lt;&lt; 5) since the values up to 16 are defined in the base class.</p>
</div>
<div class="paragraph">
<p>To use your class instead of the default, specify it in with the <code>grails.plugin.springsecurity.acl.permissionClass</code> attribute either as a Class or a String, for example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">import com.mycompany.myapp.MyPermissions
...
grails.plugin.springsecurity.acl. permissionClass = MyPermissions</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">grails.plugin.springsecurity.acl.permissionClass = 'com.mycompany.myapp.MyPermissions'</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also override the <code>aclPermissionFactory</code> bean in <code>grails-app/conf/spring/resources.groovy</code>, keeping the <code>org.springframework.security.acls.domain. DefaultPermissionFactory</code> class but passing your class as the constructor argument to keep it from defaulting to <code>BasePermission</code>, or do a more complex override to more fully reconfigure the behavior:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">import org.springframework.security.acls.domain.DefaultPermissionFactory
import com.mycompany.myapp.MyPermission

beans = {
   aclPermissionFactory(DefaultPermissionFactory, MyPermission)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once this is done you can use the permission like any other, specifying its quoted lowercase name in an expression, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">@PreAuthorize("hasPermission(#id, 'com.testacl.Report', 'approve')")
Report get(long id) {
   Report.get id
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tutorial">4. Tutorial</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First create a test application:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ grails create-app acltest
$ cd acltest</pre>
</div>
</div>
<div class="paragraph">
<p>Add a dependency for the plugin by adding it to the <code>dependencies</code> block in build.gradle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">dependencies {
   ...
   compile 'org.grails.plugins:spring-security-acl:unspecified'
   ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and run the <code>compile</code> command to resolve the dependencies:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ grails compile</pre>
</div>
</div>
<div class="paragraph">
<p>This will transitively install the <a href="http://grails.org/plugin/spring-security-core">Spring Security Core</a> plugin, so you&#8217;ll need to configure that by running the <code>s2-quickstart</code> script:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ grails s2-quickstart com.testacl User Role</pre>
</div>
</div>
<div class="paragraph">
<p>The ACL support uses domain classes and includes them in the JAR file, but to allow customizing them (e.g. to enable Hibernate 2<sup>nd</sup>-level caching) there&#8217;s a script that copies the domain classes into your application, <a href="#s2-create-acl-domains">s2-create-acl-domains</a>. There&#8217;s no need to run this script if the default configuration is sufficient.</p>
</div>
<div class="paragraph">
<p>Note that you cannot change the domain class names or packages since the plugin references them by name. Grails allows you to override plugin artifacts by creating (or copying and modifying existing) classes with the same name and package in your application.</p>
</div>
<div class="paragraph">
<p>For portability, the domain class mappings are configured to generate the same DDL as is required by the standard Spring Security JDBC implementation.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll need a domain class to test with, so create a <code>Report</code> domain class:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ grails create-domain-class com.testacl.Report</pre>
</div>
</div>
<div class="paragraph">
<p>and add a <code>name</code> property for testing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.testacl

class Report {
   String name
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next we&#8217;ll create a service to test ACLs:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ grails create-service com.testacl.Report</pre>
</div>
</div>
<div class="paragraph">
<p>and add some methods that work with <code>Report</code>s:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.testacl

import static org.springframework.security.acls.domain.BasePermission.ADMINISTRATION

import org.springframework.security.access.prepost.PostFilter
import org.springframework.security.access.prepost.PreAuthorize
import org.springframework.security.acls.domain.DefaultPermissionFactory
import org.springframework.security.acls.model.AccessControlEntry
import org.springframework.security.acls.model.MutableAcl
import org.springframework.security.acls.model.Permission
import org.springframework.security.acls.model.Sid

import grails.compiler.GrailsCompileStatic
import grails.plugin.springsecurity.SpringSecurityService
import grails.plugin.springsecurity.acl.AclService
import grails.plugin.springsecurity.acl.AclUtilService
import grails.gorm.transactions.Transactional

@GrailsCompileStatic
class ReportService {

   DefaultPermissionFactory aclPermissionFactory
   AclService aclService
   AclUtilService aclUtilService
   SpringSecurityService springSecurityService

   void addPermission(Report report, String username, int permission) {
      addPermission report, username, aclPermissionFactory.buildFromMask(permission)
   }

   @PreAuthorize('hasPermission(#report, admin)')
   @Transactional
   void addPermission(Report report, String username, Permission permission) {
      aclUtilService.addPermission report, username, permission
   }

   @Transactional
   @PreAuthorize('hasRole("ROLE_USER")')
   Report create(String name) {
      Report report = new Report(name: name).save(failOnError: true)

      // Grant the current principal administrative permission
      addPermission report, springSecurityService.authentication.name, ADMINISTRATION

      report
   }

   @PreAuthorize('hasPermission(#id, "com.testacl.Report", read) or hasPermission(#id, "com.testacl.Report", admin)')
   Report get(long id) {
      Report.get id
   }

   @PreAuthorize('hasRole("ROLE_USER")')
   @PostFilter('hasPermission(filterObject, read) or hasPermission(filterObject, admin)')
   List&lt;Report&gt; list(Map params) {
      Report.list params
   }

   int count() {
      Report.count()
   }

   @Transactional
   @PreAuthorize('hasPermission(#report, write) or hasPermission(#report, admin)')
   void update(Report report, String name) {
      report.name = name
   }

   @Transactional
   @PreAuthorize('hasPermission(#report, delete) or hasPermission(#report, admin)')
   void delete(Report report) {
      report.delete()

      // Delete the ACL information as well
      aclUtilService.deleteAcl report
   }

   @Transactional
   @PreAuthorize('hasPermission(#report, admin)')
   void deletePermission(Report report, Sid recipient, Permission permission) {
      MutableAcl acl = (MutableAcl)aclUtilService.readAcl(report)

      // Remove all permissions associated with this particular
      // recipient (string equality to KISS)
      acl.entries.eachWithIndex { AccessControlEntry entry, int i -&gt;
         if (entry.sid == recipient &amp;&amp; entry.permission == permission) {
            acl.deleteAce i
         }
      }

      aclService.updateAcl acl
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration specifies these rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>addPermission</code> requires that the authenticated user have admin permission on the report instance to grant a permission to someone else</p>
</li>
<li>
<p><code>create</code> requires that the authenticated user have <code>ROLE_USER</code></p>
</li>
<li>
<p><code>get</code> requires that the authenticated user have read or admin permission on the specified Report</p>
</li>
<li>
<p><code>list</code> requires that the authenticated user have ROLE_USER and read or admin permission on each returned Report; instances that don&#8217;t have granted permissions will be removed from the returned List</p>
</li>
<li>
<p><code>count</code> has no restrictions</p>
</li>
<li>
<p><code>update</code> requires that the authenticated user have write or admin permission on the report instance to edit it</p>
</li>
<li>
<p><code>delete</code> requires that the authenticated user have delete or admin permission on the report instance to edit it</p>
</li>
<li>
<p><code>deletePermission</code> requires that the authenticated user have admin permission on the report instance to delete a grant</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To test this out we&#8217;ll need some users; create a service to create users and their grants:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ grails create-service com.testacl.SampleData</pre>
</div>
</div>
<div class="paragraph">
<p>and add this code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.testacl

import static org.springframework.security.acls.domain.BasePermission.ADMINISTRATION
import static org.springframework.security.acls.domain.BasePermission.READ
import static org.springframework.security.acls.domain.BasePermission.WRITE

import org.springframework.security.authentication.UsernamePasswordAuthenticationToken
import org.springframework.security.core.authority.AuthorityUtils
import org.springframework.security.core.context.SecurityContextHolder as SCH

import grails.gorm.transactions.Transactional

@Transactional
class SampleDataService {

   def aclService
   def aclUtilService
   def objectIdentityRetrievalStrategy

   void createSampleData() {
      createUsers()
      loginAsAdmin()
      grantPermissions()

      // logout
      SCH.clearContext()
   }

   private void loginAsAdmin() {
      // have to be authenticated as an admin to create ACLs
      SCH.context.authentication = new UsernamePasswordAuthenticationToken(
         'admin', 'admin123',
         AuthorityUtils.createAuthorityList('ROLE_ADMIN'))
   }

   private void createUsers() {
      def roleAdmin = new Role(authority: 'ROLE_ADMIN').save()
      def roleUser = new Role(authority: 'ROLE_USER').save()

      3.times {
         long id = it + 1
         def user = new User("user$id", "password$id").save()
         UserRole.create user, roleUser
      }

      def admin = new User('admin', 'admin123').save()

      UserRole.create admin, roleUser
      UserRole.create admin, roleAdmin
   }

   private void grantPermissions() {
      def reports = []
      100.times {
         long id = it + 1
         def report = new Report(name: "report$id").save()
         reports &lt;&lt; report
         aclService.createAcl(
                 objectIdentityRetrievalStrategy.getObjectIdentity(report))
      }

      // grant user 1 admin on 11,12 and read on 1-67
      aclUtilService.addPermission reports[10], 'user1', ADMINISTRATION
      aclUtilService.addPermission reports[11], 'user1', ADMINISTRATION
      67.times {
         aclUtilService.addPermission reports[it], 'user1', READ
      }

      // grant user 2 read on 1-5, write on 5
      5.times {
         aclUtilService.addPermission reports[it], 'user2', READ
      }
      aclUtilService.addPermission reports[4], 'user2', WRITE

      // user 3 has no grants

      // grant admin admin on all
      for (report in reports) {
         aclUtilService.addPermission report, 'admin', ADMINISTRATION
      }

      // grant user 1 ownership on 1,2 to allow the user to grant
      aclUtilService.changeOwner reports[0], 'user1'
      aclUtilService.changeOwner reports[1], 'user1'
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and configure BootStrap.groovy to call the service at startup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">class BootStrap {

   def sampleDataService

   def init = {
      sampleDataService.createSampleData()
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To have a UI to test with, let&#8217;s create a <code>Report</code> controller and GSPs:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ grails generate-all com.testacl.Report</pre>
</div>
</div>
<div class="paragraph">
<p>But to use the controller, it will have to be reworked to use <code>ReportService</code>. It&#8217;s a good idea to put all create/edit/delete code in a transactional service, but in this case we need to move all database access to the service to ensure that appropriate access checks are made:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.testacl

import org.springframework.dao.DataIntegrityViolationException

import grails.plugin.springsecurity.annotation.Secured

@Secured('ROLE_USER')
class ReportController {

   def reportService

   def index() {
      params.max = Math.min(params.max ? params.int('max') : 10, 100)
      [reportList: reportService.list(params),
       reportCount: reportService.count()]
   }

   def create() {
      [report: new Report(params)]
   }

   def save() {
      def report = reportService.create(params.name)
      if (!renderWithErrors('create', report)) {
         redirectShow "Report $report.id created", report.id
      }
   }

   def show() {
      def report = findInstance()
      if (!report) return

      [report: report]
   }

   def edit() {
      def report = findInstance()
      if (!report) return

      [report: report]
   }

   def update() {
      def report = findInstance()
      if (!report) return

      reportService.update report, params.name
      if (!renderWithErrors('edit', report)) {
         redirectShow "Report $report.id updated", report.id
      }
   }

   def delete() {
      def report = findInstance()
      if (!report) return

      try {
         reportService.delete report
         flash.message = "Report $params.id deleted"
         redirect action: 'list'
      }
      catch (DataIntegrityViolationException e) {
         redirectShow "Report $params.id could not be deleted", params.id
      }
   }

   def grant() {

      def report = findInstance()
      if (!report) return

      if (!request.post) {
         return [report: report]
      }

      reportService.addPermission(report, params.recipient,
              params.int('permission'))

      redirectShow "Permission $params.permission granted on Report $report.id " +
              "to $params.recipient", report.id
   }

   private Report findInstance() {
      def report = reportService.get(params.long('id'))
      if (!report) {
         flash.message = "Report not found with id $params.id"
         redirect action: 'list'
      }
      report
   }

   private void redirectShow(message, id) {
      flash.message = message
      redirect action: 'show', id: id
   }

   private boolean renderWithErrors(String view, Report report) {
      if (report.hasErrors()) {
         render view: view, model: [report: report]
         return true
      }
      false
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the controller is annotated to require either <code>ROLE_USER</code> or <code>ROLE_ADMIN</code>. Since services have nothing to do with HTTP, when access is blocked you cannot be redirected to the login page as when you try to access a URL that requires an authentication. So you need to configure URLs with similar role requirements to give the user a chance to attempt a login before calling secured service methods.</p>
</div>
<div class="paragraph">
<p>Finally, we&#8217;ll make a few adjustments so errors are handled gracefully.</p>
</div>
<div class="paragraph">
<p>First, edit <code>grails-app/controllers/UrlMappings.groovy</code> and add some error code mappings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">import org.springframework.security.access.AccessDeniedException
import org.springframework.security.acls.model.NotFoundException

class UrlMappings {

   static mappings = {

      ...

      "403"(controller: 'errors', action: 'error403')
      "404"(controller: 'errors', action: 'error404')
      "500"(controller: 'errors', action: 'error500')
      "500"(controller: 'errors', action: 'error403',
            exception: AccessDeniedException)
      "500"(controller: 'errors', action: 'error403',
            exception: NotFoundException)
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then create the <code>ErrorsController</code> that these reference:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ grails create-controller com.testacl.Errors</pre>
</div>
</div>
<div class="paragraph">
<p>and add this code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">package com.testacl

import grails.plugin.springsecurity.annotation.Secured

@Secured('permitAll')
class ErrorsController {

   def error403() {}

   def error404() {
      render view: '/notFound'
   }

   def error500() {
      render view: '/error'
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and we&#8217;ll need to create the GSP for the <code>error403</code> action in <code>grails-app/views/errors/error403.gsp</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-html" data-lang="html">&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Access denied!&lt;/title&gt;
&lt;meta name='layout' content='main' /&gt;
&lt;/head&gt;

&lt;body&gt;
&lt;h1&gt;Access Denied&lt;/h1&gt;
&lt;p&gt;We're sorry, but you are not authorized
   to perform the requested operation.&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="actionsubmit-issues">4.1. actionSubmit issues</h3>
<div class="paragraph">
<p>Grails has a convenient feature where it supports multiple submit actions per form via the <code>&lt;g:actionSubmit&gt;</code> tag. This is done by posting to the <code>index</code> action but with a special parameter that indicates which action to invoke. This is a problem in general for security since any URL rules for edit, delete, save, etc. will be bypassed. It&#8217;s an even more significant issue with ACLs because of the way that the access denied exception interacts with the <code>actionSubmit</code> processing. If you don&#8217;t make any adjustments for this, your users will see a blank page when they attempt to submit a form and the action is disallowed. The solution is to remove <code>actionSubmit</code> buttons and replace them with regular submit buttons. This requires one form per button, and without adjusting the CSS the buttons will look differently than if they were in-line <code>actionSubmit</code> buttons, but that is fixable with the appropriate CSS changes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that this is not an issue when using the generated GSPs in Grails 3 because they&#8217;ve been reworked to use the fields plugin, but if you have an older application that you&#8217;ve upgraded or if you have GSPs that don&#8217;t use the newer approach, you will need to avoid using <code>actionSubmit</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It&#8217;s simple to adjust the <code>actionSubmit</code> buttons and you&#8217;ll need to change them in <code>show.gsp</code> and <code>edit.gsp</code>; <code>list.gsp</code> (or <code>index.gsp</code>) and <code>show.gsp</code> don&#8217;t need any changes. In <code>show.gsp</code>, replace the two actionSubmit buttons with these two forms (maintain the g:message tags; the strings are hard-coded here to reduce clutter):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-html" data-lang="html">&lt;div class="buttons"&gt;
    &lt;g:form action='edit'&gt;
        &lt;g:hiddenField name="id" value="${reportInstance?.id}" /&gt;
        &lt;span class="button"&gt;
            &lt;g:submitButton class="edit" name="Edit" /&gt;
        &lt;/span&gt;
    &lt;/g:form&gt;
    &lt;g:form action='delete'&gt;
        &lt;g:hiddenField name="id" value="${reportInstance?.id}" /&gt;
        &lt;span class="button"&gt;
            &lt;g:submitButton class="delete" name="Delete"
                            onclick="return confirm('Are you sure?');" /&gt;
        &lt;/span&gt;
    &lt;/g:form&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In <code>grails-app/views/report/edit.gsp</code>, change the <code>&lt;form&gt;</code> tag to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-html" data-lang="html">&lt;g:form action='update'&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>and convert the update button to a regular submit button:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-html" data-lang="html">&lt;div class="buttons"&gt;
    &lt;span class="button"&gt;&lt;g:submitButton class="save" name="Update" /&gt;&lt;/span&gt;
&lt;/div&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>and move the delete button out of the form into its own form just below the main form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-html" data-lang="html">&lt;g:form action='delete'&gt;
    &lt;g:hiddenField name="id" value="${reportInstance?.id}" /&gt;
    &lt;div class="buttons"&gt;
        &lt;span class="button"&gt;
            &lt;g:submitButton class="delete" name="Delete"
                            onclick="return confirm('Are you sure?');" /&gt;
        &lt;/span&gt;
    &lt;/div&gt;
&lt;/g:form&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>list.gsp</code> (or <code>index.gsp</code>) and <code>show.gsp</code> are fine as they are.</p>
</div>
<div class="paragraph">
<p>Finally, to make it easier to log out (by default POST is required, so typical link that uses GET won&#8217;t work), add this to <code>grails-app/views/layouts/main.gsp</code> before the <code>&lt;g:layoutBody/&gt;</code> tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-html" data-lang="html">&lt;sec:ifLoggedIn&gt;

&lt;g:form controller='logout'&gt;
   Logged in as &lt;sec:username/&gt; - &lt;g:submitButton name='logout' value='Logout'/&gt;
&lt;/g:form&gt;

&lt;/sec:ifLoggedIn&gt;
&lt;sec:ifNotLoggedIn&gt;

&lt;g:link controller='login' action='auth'&gt;Login&lt;/g:link&gt;

&lt;/sec:ifNotLoggedIn&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>and you&#8217;ll see a link to login if not authenticated, and a button to click to logout if you are.</p>
</div>
</div>
<div class="sect2">
<h3 id="testing">4.2. Testing</h3>
<div class="paragraph">
<p>Now start the app:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ grails run-app</pre>
</div>
</div>
<div class="paragraph">
<p>and open <a href="http://localhost:8080/report" class="bare">http://localhost:8080/report</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you see the error <code>NoSuchMethodError: org.springframework.cache.ehcache.EhCacheFactoryBean.setMaxEntriesLocalHeap(J)V</code> when starting the app, comment out the <code>compile 'org.hibernate:hibernate-ehcache'</code> dependency and disable the second-level cache in <code>application.yml</code> with <code>use_second_level_cache: false</code>, and restart.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Login as user1/password1 and you should see the first page of results. But if you click on page 7 or higher, you&#8217;ll see that you can only see a subset of the <code>Report</code>s. This illustrates one issue with using ACLs to restrict view access to instances; you would have to add joins in your query to the ACL database tables to get an accurate count of the total number of visible instances.</p>
</div>
<div class="paragraph">
<p>Click on any of the report instance links (e.g. <a href="http://localhost:8080/report/show/63" class="bare">http://localhost:8080/report/show/63</a>) to verify that you can view the instance. You can test that you have no view access to the filtered instances by navigating to <a href="http://localhost:8080/report/show/83" class="bare">http://localhost:8080/report/show/83</a>.</p>
</div>
<div class="paragraph">
<p>Verify that user1 has admin permission on report #11 by editing it and deleting it.</p>
</div>
<div class="paragraph">
<p>Verify that user1 doesn&#8217;t have admin permission on report #13 by trying to editing or delete it and you should see the error page when you submit the form.</p>
</div>
<div class="paragraph">
<p>Logout (by navigating to <a href="http://localhost:8080/logout" class="bare">http://localhost:8080/logout</a>) and login as user2/password2. You should only see the first five reports. Verify that you can edit #5 but not any of the others, and that you can&#8217;t delete any.</p>
</div>
<div class="paragraph">
<p>Finally. logout and login as admin/admin123. You should be able to view, edit, and delete all instances.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sampleApp">5. Sample Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Working with ACLs in Spring Security is complex but it will be easier to understand with a sample application. To help get you started, there&#8217;s a Grails application that uses the plugin to test with. It&#8217;s based on the Spring Security <a href="https://github.com/spring-projects/spring-security/tree/master/samples/xml/contacts">Contacts</a> sample application. But where the Spring Security application uses SpringMVC, JDBC, etc., this application is 100% Grails. The application is available <a href="https://github.com/grails-spring-security-samples/grails-contacts">at GitHub</a>.</p>
</div>
<div class="paragraph">
<p>Clone or fork the repo and start the app:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ./gradlew bootRun</pre>
</div>
</div>
<div class="paragraph">
<p>Open <a href="http://localhost:8080/" class="bare">http://localhost:8080/</a> in a browser to get started. The main functionality is at <a href="http://localhost:8080/secure" class="bare">http://localhost:8080/secure</a>. The login page lists the various configured users and their passwords; the "rod" user is an admin and has full access and the other users have various grants and ownership.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="AclUtilService">6. AclUtilService</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="addPermission">6.1. addPermission</h3>
<div class="paragraph">
<div class="title">Purpose</div>
<p>Grant a permission on a domain object instance to a recipient.</p>
</div>
<div class="listingblock">
<div class="title">Examples</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">aclUtilService.addPermission Report, 1124, 'user123', BasePermission.WRITE

aclUtilService.addPermission reportInstance, 'user123', BasePermission.WRITE</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Description</div>
<p><code>addPermission</code> has three signatures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">void addPermission(Class&lt;?&gt; domainClass, long id, recipient, Permission permission)

void addPermission(domainObject, recipient, Permission permission)

void addPermission(ObjectIdentity oid, recipient, Permission permission)</code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Parameters</div>
<ul>
<li>
<p><code>domainClass</code> - the domain class, used when specifying the class and id</p>
</li>
<li>
<p><code>id</code> - the instance id, used when specifying the class and id</p>
</li>
<li>
<p><code>domainObject</code> - the domain class instance, used when the instance is available</p>
</li>
<li>
<p><code>recipient</code> - the grantee; can be a String (username or role name), or a <code>Sid</code>, or an <code>Authentication</code></p>
</li>
<li>
<p><code>permission</code> - the permission to grant</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="changeOwner">6.2. changeOwner</h3>
<div class="paragraph">
<div class="title">Purpose</div>
<p>Change the ACL owner for a domain class instance.</p>
</div>
<div class="listingblock">
<div class="title">Examples</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">aclUtilService.changeOwner reportInstance, 'user123'</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Description</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">void changeOwner(domainObject, String newUsername)</code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Parameters</div>
<ul>
<li>
<p><code>domainObject</code> - the domain class instance</p>
</li>
<li>
<p><code>newUsername</code> - the username of the new owner</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="deleteAcl">6.3. deleteAcl</h3>
<div class="paragraph">
<div class="title">Purpose</div>
<p>Deletes the ACL for a domain class instance.</p>
</div>
<div class="listingblock">
<div class="title">Examples</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">aclUtilService.deleteAcl reportInstance</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Description</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">void deleteAcl(domainObject)</code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Parameters</div>
<ul>
<li>
<p><code>domainObject</code> - the domain class instance</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="deletePermission">6.4. deletePermission</h3>
<div class="paragraph">
<div class="title">Purpose</div>
<p>Removes a granted permission.</p>
</div>
<div class="listingblock">
<div class="title">Examples</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">aclUtilService.deletePermission Report, 42, 'user123', BasePermission.WRITE

aclUtilService.deletePermission reportInstance, 'user123', BasePermission.WRITE</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Description</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">void deletePermission(domainObject, recipient, Permission permission)

void deletePermission(Class&lt;?&gt; domainClass, long id, recipient, Permission permission)</code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Parameters</div>
<ul>
<li>
<p><code>domainClass</code> - the domain class, used when specifying the class and id</p>
</li>
<li>
<p><code>id</code> - the instance id, used when specifying the class and id</p>
</li>
<li>
<p><code>domainObject</code> - the domain class instance, used when the instance is available</p>
</li>
<li>
<p><code>recipient</code> - the grantee; can be a String (username or role name), or a <code>Sid</code>, or an <code>Authentication</code></p>
</li>
<li>
<p><code>permission</code> - the permission to remove</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="hasPermission">6.5. hasPermission</h3>
<div class="paragraph">
<div class="title">Purpose</div>
<p>Check if the authentication has grants for the specified permission(s) on the domain class instance.</p>
</div>
<div class="listingblock">
<div class="title">Examples</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">if (aclUtilService.hasPermission(auth, reportInstance, BasePermission.WRITE)) {
   ...
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Description</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">boolean hasPermission(Authentication authentication, domainObject, Permission... permissions)

boolean hasPermission(Authentication authentication, domainObject, List&lt;Permission&gt; permissions)</code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Parameters</div>
<ul>
<li>
<p><code>authentication</code> - an authentication representing a user and associated roles</p>
</li>
<li>
<p><code>domainObject</code> - the domain class instance</p>
</li>
<li>
<p><code>permissions</code> - one or more permissions to check</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="readAcl">6.6. readAcl</h3>
<div class="paragraph">
<div class="title">Purpose</div>
<p>Retrieves the ACL for a domain class instance.</p>
</div>
<div class="listingblock">
<div class="title">Examples</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">def acl = aclUtilService.readAcl(reportInstance)

def acl = aclUtilService.readAcl(Report, 42)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Description</div>
<div class="content">
<pre class="prettyprint highlight"><code class="language-java" data-lang="java">Acl readAcl(domainObject)

Acl readAcl(Class&lt;?&gt; domainClass, id)</code></pre>
</div>
</div>
<div class="ulist">
<div class="title">Parameters</div>
<ul>
<li>
<p><code>domainClass</code> - the domain class, used when specifying the class and id</p>
</li>
<li>
<p><code>id</code> - the instance id, used when specifying the class and id</p>
</li>
<li>
<p><code>domainObject</code> - the domain class instance, used when the instance is available</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="Scripts">7. Scripts</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="s2-create-acl-domains">7.1. s2-create-acl-domains</h3>
<div class="paragraph">
<div class="title">Purpose</div>
<p>Creates the domain classes that manage ACL data.</p>
</div>
<div class="literalblock">
<div class="title">Example</div>
<div class="content">
<pre>grails s2-create-acl-domains</pre>
</div>
</div>
<div class="paragraph">
<div class="title">Description</div>
<p>The plugin includes the required ACL domain classes, but if you want to customize them (for example to configure 2<sup>nd</sup>-level caching) you can use this script to generate the same domain classes in your application&#8217;s <code>grails-app/domain</code> folder to allow minor customization.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="TagLibraries">8. Tag Libraries</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="permitted">8.1. permitted</h3>
<div class="paragraph">
<div class="title">Purpose</div>
<p>Renders the body if the user is granted the specified permission(s)</p>
</div>
<div class="paragraph">
<div class="title">Examples</div>
<p>Single String:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-html" data-lang="html">&lt;sec:permitted className='com.foo.Report' id='${reportId}' permission='read'&gt;

the body content

&lt;/sec:permitted&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Multiple String:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-html" data-lang="html">&lt;sec:permitted className='com.foo.Report' id='${reportId}' permission='write,read'&gt;

the body content

&lt;/sec:permitted&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Single Permission:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-html" data-lang="html">&lt;%@ page import="org.springframework.security.acls.domain.BasePermission" %&gt;

&lt;sec:permitted className='com.foo.Report' id='${reportId}' permission='${BasePermission.READ}'&gt;

the body content

&lt;/sec:permitted&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>List of Permission:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-html" data-lang="html">&lt;%@ page import="org.springframework.security.acls.domain.BasePermission" %&gt;

&lt;sec:permitted className='com.foo.Report' id='${reportId}' permission='${[BasePermission.WRITE,BasePermission.READ]}'&gt;

the body content

&lt;/sec:permitted&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Single mask int:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-html" data-lang="html">&lt;sec:permitted className='com.foo.Report' id='${reportId}' permission='${1}'&gt;

the body content

&lt;/sec:permitted&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Multiple mask int:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-html" data-lang="html">&lt;sec:permitted className='com.foo.Report' id='${reportId}' permission='2,1'&gt;

the body content

&lt;/sec:permitted&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Description</div>
<p>Renders the body if the user has grants for the specified permissions. Permissions are specified in the &#8220;permission&#8221; attribute and can be a single Permission, an array of Permission, an int/Integer (which is assumed to be a mask), a String (which can be a single name, or a comma-delimited list of names, or a comma-delimited list of masks), or a List of any of these.</p>
</div>
</div>
<div class="sect2">
<h3 id="notPermitted">8.2. notPermitted</h3>
<div class="paragraph">
<div class="title">Purpose</div>
<p>Renders the body if the user is not granted the specified permission(s)</p>
</div>
<div class="paragraph">
<div class="title">Examples</div>
<p>Single String:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-html" data-lang="html">&lt;sec:notPermitted className='com.foo.Report' id='${reportId}' permission='read'&gt;

the body content

&lt;/sec:notPermitted&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Multiple String:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-html" data-lang="html">&lt;sec:notPermitted className='com.foo.Report' id='${reportId}' permission='read,write'&gt;

the body content

&lt;/sec:notPermitted&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Single Permission:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-html" data-lang="html">&lt;%@ page import="org.springframework.security.acls.domain.BasePermission" %&gt;

&lt;sec:notPermitted className='com.foo.Report' id='${reportId}' permission='${BasePermission.READ}'&gt;

the body content

&lt;/sec:notPermitted&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>List of Permission:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-html" data-lang="html">&lt;%@ page import="org.springframework.security.acls.domain.BasePermission" %&gt;

&lt;sec:notPermitted className='com.foo.Report' id='${reportId}' permission='${[BasePermission.WRITE,BasePermission.READ]}'&gt;

the body content

&lt;/sec:notPermitted&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Single mask int:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-html" data-lang="html">&lt;sec:notPermitted className='com.foo.Report' id='${reportId}' permission='${1}'&gt;

the body content

&lt;/sec:notPermitted&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Multiple mask int:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code class="language-html" data-lang="html">&lt;sec:notPermitted className='com.foo.Report' id='${reportId}' permission='2,1'&gt;

the body content

&lt;/sec:notPermitted&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Description</div>
<p>Renders the body if the user does not have grants for the specified permissions. Permissions are specified in the &#8220;permission&#8221; attribute and can be a single Permission, an array of Permission, an int/Integer (which is assumed to be a mask), a String (which can be a single name, or a comma-delimited list of names, or a comma-delimited list of masks), or a List of any of these.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="History">9. History</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Apr 8, 2019</p>
<div class="ulist">
<ul>
<li>
<p>4.0.0.M1 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>Feb 15, 2018</p>
<div class="ulist">
<ul>
<li>
<p>3.2.1 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>Dec 4, 2017</p>
<div class="ulist">
<ul>
<li>
<p>3.2.0 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>May 4, 2017</p>
<div class="ulist">
<ul>
<li>
<p>3.1.1 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>December 20, 2015</p>
<div class="ulist">
<ul>
<li>
<p>3.0.1 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>December 8, 2015</p>
<div class="ulist">
<ul>
<li>
<p>3.0.0 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>August 25, 2015</p>
<div class="ulist">
<ul>
<li>
<p>3.0.0.M1 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>November 17, 2014</p>
<div class="ulist">
<ul>
<li>
<p>2.0-RC2 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>October 08, 2013</p>
<div class="ulist">
<ul>
<li>
<p>2.0-RC1 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>August 20, 2012</p>
<div class="ulist">
<ul>
<li>
<p>1.1.1 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>February 16, 2011</p>
<div class="ulist">
<ul>
<li>
<p>1.1 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>February 7, 2011</p>
<div class="ulist">
<ul>
<li>
<p>1.0.2 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>August 1, 2010</p>
<div class="ulist">
<ul>
<li>
<p>1.0.1 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>July 27, 2010</p>
<div class="ulist">
<ul>
<li>
<p>1.0 release</p>
</li>
</ul>
</div>
</li>
<li>
<p>May 22, 2010</p>
<div class="ulist">
<ul>
<li>
<p>initial 0.1 release</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="authors">9.1. Authors</h3>
<div class="paragraph">
<p>Burt Beckwith</p>
</div>
</div>
<div class="sect2">
<h3 id="previouswork">9.2. Previous work</h3>
<div class="paragraph">
<p>Stephan February did the <a href="http://blog.bruary.net/2008/04/grails-acegi-acl-howto.html">first work</a> adding ACL support to the <a href="http://grails.org/plugin/acegi/">Acegi</a> plugin. At the time the plugin was based on Acegi 1.0.x and around the same time the plugin was converted to use Spring Security 2.0 and the ACL support wasn&#8217;t converted to use the new package layout and approach.</p>
</div>
<div class="paragraph">
<p>Work was done in 2009 to create a GORM-based implementation (the standard Spring Security implementation uses JDBC). Around the same time, Phillip Merensky <a href="http://grails.1312388.n4.nabble.com/Acegi-Plugin-0-5-1-with-ACL-support-implemented-td1400650.html">mentioned on the Grails mailing list</a> that he was working on an implementation. He wrote about his approach <a href="http://imagesiteproject.wordpress.com/2009/09/24/integration-of-spring-security-into-grails-plugin-approach-3/">here</a> and this was merged in with the other approach but never formally released.</p>
</div>
<div class="paragraph">
<p>This plugin builds on that work but is based on Spring Security 4 and Spring 4.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 4.0.0.M1<br>
Last updated 2019-04-09 20:09:01 +00:00
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.min.js"></script>
<script>prettyPrint()</script>
</body>
</html>